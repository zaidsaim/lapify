!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ReduxReplicate=e():t.ReduxReplicate=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.FULLY_INITIALIZED=e.SET_STATE=e.STATE_CHANGE_ERROR=e.REPLICATED_STATE=e.REPLICATE_STATE=e.REPLICATED_INITIAL_STATE=e.REPLICATE_INITIAL_STATE=e.INITIAL_STATE_ERROR=e.GOT_INITIAL_STATE=e.GET_INITIAL_STATE=e.storeKeysEqual=e.replicate=void 0;var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},o=r(4),i=n(o),c=r(5),u=n(c),T=r(2),l=n(T),f=r(1),s=function(t){return function(e){return function(r,n,o){var c=null;t=a({},t);var T=function(e,n){var o=e;return n.type!==f.SET_STATE||n.mergedState||(o=t.reducerKeys?a({},e,n.nextState):n.nextState,n.mergedState=!0),o=r(o,n),n._skipReplication||(0,u.default)(c,t,e,o,n),o};return c=e(T,n,o),c.replication||(c.replication=[]),c.replication.push(t),c.onReady||(c.readyCallbacks=[],c.onReady=function(t){return c.readyCallbacks.push(t)}),"undefined"!=typeof t.key&&(c.key=t.key),c.setKey||(c.setKey=function(t,e){c.key=t,e&&c.onReady(e),c.replication.forEach(function(t){(0,i.default)(c,t)})}),c.setState||(c.setState=function(t,e,r){c.dispatch({type:f.SET_STATE,nextState:t,_skipReplication:e,__create:r})}),(0,i.default)(c,t),c}}};e.default=s,e.replicate=s,e.storeKeysEqual=l.default,e.GET_INITIAL_STATE=f.GET_INITIAL_STATE,e.GOT_INITIAL_STATE=f.GOT_INITIAL_STATE,e.INITIAL_STATE_ERROR=f.INITIAL_STATE_ERROR,e.REPLICATE_INITIAL_STATE=f.REPLICATE_INITIAL_STATE,e.REPLICATED_INITIAL_STATE=f.REPLICATED_INITIAL_STATE,e.REPLICATE_STATE=f.REPLICATE_STATE,e.REPLICATED_STATE=f.REPLICATED_STATE,e.STATE_CHANGE_ERROR=f.STATE_CHANGE_ERROR,e.SET_STATE=f.SET_STATE,e.FULLY_INITIALIZED=f.FULLY_INITIALIZED},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="@@redux-replicate";e.GET_INITIAL_STATE=r+"/GET_INITIAL_STATE",e.GOT_INITIAL_STATE=r+"/GOT_INITIAL_STATE",e.INITIAL_STATE_ERROR=r+"/INITIAL_STATE_ERROR",e.REPLICATE_INITIAL_STATE=r+"/REPLICATE_INITIAL_STATE",e.REPLICATED_INITIAL_STATE=r+"/REPLICATED_INITIAL_STATE",e.REPLICATE_STATE=r+"/REPLICATE_STATE",e.REPLICATED_STATE=r+"/REPLICATED_STATE",e.STATE_CHANGE_ERROR=r+"/STATE_CHANGE_ERROR",e.SET_STATE=r+"/SET_STATE",e.FULLY_INITIALIZED=r+"/FULLY_INITIALIZED"},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t,e){return t===e||t&&t.toString&&e&&e.toString&&t.toString()===e.toString()};e.default=r},function(t,e){"use strict";function r(t,e){var r=t.clientState,n=t.reducerKeys,a=n,o=null;if(n===!0&&(n=Object.keys(e),a=n),r)if(a=[],o=[],Array.isArray(n)){var i=!0,c=!1,u=void 0;try{for(var T,l=n[Symbol.iterator]();!(i=(T=l.next()).done);i=!0){var f=T.value;"undefined"==typeof r[f]?a.push(f):o.push(f)}}catch(t){c=!0,u=t}finally{try{!i&&l.return&&l.return()}finally{if(c)throw u}}}else{for(var s in n)n[s]&&"undefined"==typeof r[s]?a.push(s):o.push(s);n=Object.keys(n)}return t.reducerKeys=n,{getReducerKeys:a,setReducerKeys:o}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=r},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=r(3),c=n(i),u=r(2),T=n(u),l=r(1),f=function(t,e){var r=[].concat(e.replicator),n=r.filter(function(e){return e.onReady&&t.onReady(e.onReady),"function"==typeof e.getInitialState});t.initializingReplication=(t.initializingReplication||0)+1,t.initializedReplication=!1;var i=1,u=!1,f=e.reducerKeys?{}:null,s=function(){if(0===--i&&(u&&t.setState(f,!0),0===--t.initializingReplication)){for(;t.readyCallbacks.length;)t.readyCallbacks.shift()({store:t});t.initializedReplication=!0,delete e.create,delete e.clientState,delete e.creatorStore,t.dispatch({type:l.FULLY_INITIALIZED})}};if(!t.key)return void s();var y=t.key,E=t.getState(),_=function(t){return e.create||e.clientState&&(!t||"undefined"!=typeof e.clientState[t])},I=function(r){var n=r.getInitialState,c=r.onStateChange;return function(r){var I=r?e.clientState&&e.clientState[r]:e.clientState,S={reducerKey:r,nextState:r?E[r]:E,queryable:"object"===o(e.queryable)?e.queryable[r]:e.queryable,create:e.create,clientState:I};t.dispatch(a({type:l.GET_INITIAL_STATE},S)),i++,n({store:t,reducerKey:r,clientState:I,setState:function(e){if("undefined"==typeof e){if(c&&_(r)){var n=a({type:l.REPLICATE_INITIAL_STATE},S);t.dispatch(n),i++,c(a({},S,{store:t,action:n,setState:function(e){t.setState(e,!0),t.dispatch(a({type:l.REPLICATED_INITIAL_STATE},S,{state:e})),s()},setStatus:function(e){t.dispatch(a({type:l.REPLICATED_INITIAL_STATE},S,{status:e})),s()},setError:function(e){t.dispatch(a({type:l.STATE_CHANGE_ERROR},S,{error:e})),s()}}))}}else(0,T.default)(y,t.key)&&(r?f[r]=e:f=e,u=!0);t.dispatch(a({type:l.GOT_INITIAL_STATE},S,{state:e})),s()},setError:function(e){t.dispatch(a({type:l.INITIAL_STATE_ERROR},S,{error:e})),s()}})}};if(e.reducerKeys){var S=(0,c.default)(e,E),A=S.getReducerKeys,d=S.setReducerKeys;if(d){var p=!0,R=!1,v=void 0;try{for(var L,b=r[Symbol.iterator]();!(p=(L=b.next()).done);p=!0){var h=L.value;if(h.onStateChange){var N=!0,C=!1,O=void 0;try{for(var m,P=d[Symbol.iterator]();!(N=(m=P.next()).done);N=!0){var k=m.value;_(k)&&!function(){var r={reducerKey:k,nextState:k?E[k]:E,queryable:"object"===o(e.queryable)?e.queryable[k]:e.queryable,create:e.create,clientState:k?e.clientState&&e.clientState[k]:e.clientState},n=a({type:l.REPLICATE_INITIAL_STATE},r);t.dispatch(n),i++,h.onStateChange(a({},r,{store:t,action:n,setState:function(e){t.setState(e,!0),t.dispatch(a({type:l.REPLICATED_INITIAL_STATE},r,{state:e})),s()},setStatus:function(e){t.dispatch(a({type:l.REPLICATED_INITIAL_STATE},r,{status:e})),s()},setError:function(e){t.dispatch(a({type:l.STATE_CHANGE_ERROR},r,{error:e})),s()}}))}()}}catch(t){C=!0,O=t}finally{try{!N&&P.return&&P.return()}finally{if(C)throw O}}}}}catch(t){R=!0,v=t}finally{try{!p&&b.return&&b.return()}finally{if(R)throw v}}}var x=!0,g=!1,j=void 0;try{for(var D,G=n[Symbol.iterator]();!(x=(D=G.next()).done);x=!0){var K=D.value,q=I(K),w=!0,M=!1,H=void 0;try{for(var z,F=A[Symbol.iterator]();!(w=(z=F.next()).done);w=!0){var U=z.value;q(U)}}catch(t){M=!0,H=t}finally{try{!w&&F.return&&F.return()}finally{if(M)throw H}}}}catch(t){g=!0,j=t}finally{try{!x&&G.return&&G.return()}finally{if(g)throw j}}}else{var Y=!0,Z=!1,B=void 0;try{for(var J,Q=n[Symbol.iterator]();!(Y=(J=Q.next()).done);Y=!0){var V=J.value;I(V)()}}catch(t){Z=!0,B=t}finally{try{!Y&&Q.return&&Q.return()}finally{if(Z)throw B}}}s()};e.default=f},function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=r(1),c=n(i),u=c.REPLICATE_STATE,T=c.REPLICATED_STATE,l=c.STATE_CHANGE_ERROR,f={};for(var s in c)f[c[s]]=!0;var y=function(t,e,r,n,i){if(e.creatorStore&&f[i.type]&&e.creatorStore.dispatch(i),t&&t.key&&t.initializedReplication){var c=[].concat(e.replicator),s=!0,y=!1,E=void 0;try{for(var _,I=c[Symbol.iterator]();!(s=(_=I.next()).done);s=!0){var S=_.value;if(S.onStateChange)if(e.reducerKeys){var A=!0,d=!1,p=void 0;try{for(var R,v=e.reducerKeys[Symbol.iterator]();!(A=(R=v.next()).done);A=!0){var L=R.value;r[L]!==n[L]&&!function(){var c={reducerKey:L,state:r[L],nextState:n[L],queryable:"object"===o(e.queryable)?e.queryable[L]:e.queryable,create:!!i.__create&&function(e){return setTimeout(function(){t.setState(e,!0),t.dispatch(a({type:T},c,{state:e}))})}};setTimeout(function(){t.dispatch(a({type:u},c))}),S.onStateChange(a({},c,{store:t,action:i,setState:function(e){return setTimeout(function(){t.setState(e,!0),t.dispatch(a({type:T},c,{state:e})),i.__callback&&i.__callback()})},setStatus:function(e){return setTimeout(function(){t.dispatch(a({type:T},c,{status:e})),i.__callback&&i.__callback()})},setError:function(e){return setTimeout(function(){t.dispatch(a({type:l},c,{error:e})),i.__callback&&i.__callback()})}}))}()}}catch(t){d=!0,p=t}finally{try{!A&&v.return&&v.return()}finally{if(d)throw p}}}else r!==n&&!function(){var o={state:r,nextState:n,queryable:e.queryable,create:!!i.__create&&function(e){return setTimeout(function(){t.setState(e,!0),t.dispatch(a({type:T},o,{state:e}))})}};setTimeout(function(){t.dispatch(a({type:u},o))}),S.onStateChange(a({},o,{store:t,action:i,setState:function(e){return setTimeout(function(){t.setState(e,!0),t.dispatch(a({type:T},o,{state:e})),i.__callback&&i.__callback()})},setStatus:function(e){return setTimeout(function(){t.dispatch(a({type:T},o,{status:e})),i.__callback&&i.__callback()})},setError:function(e){return setTimeout(function(){t.dispatch(a({type:l},o,{error:e})),i.__callback&&i.__callback()})}}))}();S.postReduction&&S.postReduction({store:t,state:r,nextState:n,action:i})}}catch(t){y=!0,E=t}finally{try{!s&&I.return&&I.return()}finally{if(y)throw E}}}};e.default=y}])});